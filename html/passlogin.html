<!DOCTYPE html>
<html>
<head>
    <title>Tugas 3 - 05111840000080</title>
    
    <!-- CSS only -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

</head>
<body class="bg-dark">
    <div class="container w-50" style="margin-top: 15%;">
		<h1 class="d-flex justify-content-center display-4 text-light p-1">Enter Password</h1>
        <div class="form-group d-flex justify-content-center mx-sm-3">
            <input class="form-control w-50" id="passField" type="password" placeholder="Enter password">
        </div>
        <div class="form-group d-flex justify-content-center mx-sm-3">
            <input class="form-control w-50" id="passField2" type="password" placeholder="Confirm password">
        </div>
        <div class="form-group d-flex justify-content-center">
            <button type="button" onclick="submitClicked()" class="btn btn-success center" style="display: block;">SUBMIT</button>
        </div>
        <div class="form-group d-flex justify-content-center">
            <a href="../php/logout.php" class="text-info">USE ANOTHER ACCOUNT</a>
        </div>
	</div>

    <!-- JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="../js/users.js"></script>
    <script type="text/javascript">
        var user = "<?php echo $_SESSION['username']; ?>";

        var realPass = "<?php echo $_SESSION['password']; ?>";
        var passField = document.getElementById("passField");
        var ap = document.getElementById("alertPar");
        // console.log(realPass);
        var passField2 = document.getElementById("passField2");

        if(realPass == "")
        {
            passField2.style.display = "table-row";
        }
        else passField2.style.display = "none";

        var adminFlag = "<?php echo $_SESSION['status']; ?>";
        // console.log(adminFlag);

        function submitClicked(){
            if(realPass != "")
            {
                if(passField.value == realPass)
                {
                    window.location.replace("home.php");
                }
                else {
                    ap.innerHTML = "Wrong Password";
                    console.log("wrong pw");
                }

                var detail = {
                    "username": user,
                    "password": realPass,
                    "admin_flag": adminFlag
                };

                // document.cookie = JSON.stringify(detail);
                localStorage.setItem('detail', JSON.stringify(detail));
            }
            else
            {
                if(passField.value == passField2.value)
                {
                    $.ajax({
                        type: "POST",
                        url: "storesession.php",
                        data: {username: user, password: passField.value, status: "0"}
                    });

                    window.location.replace("addaccount.php");
                }
                else
                    alert("Confirm password should be the same. ");

                var detail = {
                    "username": user,
                    "password": passField.value,
                    "admin_flag": 0
                };
                // document.cookie = JSON.stringify(detail);
                localStorage.setItem('detail', JSON.stringify(detail));
            }
        }
    </script>
</body>
</html>